@using Sandbox.UI;

@namespace Facepunch.Boomer.UI
@attribute [StyleSheet( "/ui/Settings/SettingsMenu.scss" )]

<root>
	<div class="main">
		<div class="navbar">
			<label class="title">#GameSettings.GeneralSettings</label>
		</div>

		<div class="body">
			<ObjectEditor @ref=Editor />
		</div>

		<div class="grow" />

		<div class="footer">
			<button onclick=@SetDefaults><i>restart_alt</i>#GameSettings.Reset</button>
			<button onclick=@Close class="exit"><i>close</i>#GameSettings.Close</button>
		</div>
	</div>
</root>

@code {
	public ObjectEditor Editor;

	public SettingsMenu()
	{
		Current = this;
	}

	public override void OnHotloaded()
	{
		base.OnHotloaded();

		Editor.SetTarget( ClientSettings.Current );
	}

	protected override void OnAfterTreeRender(bool firstTime)
	{
		if ( firstTime )
			Editor.SetTarget( ClientSettings.Current );
	}

	public void SetDefaults()
	{
		ClientSettings.Reset();

		Editor.SetTarget( ClientSettings.Current );
	}

	public void Close() => SetOpen( false );

	private static SettingsMenu Current;
	public static void SetOpen( bool open ) => Current?.SetClass( "open", open );
	public static void ToggleOpen() => Current?.SetClass( "open", !Current.HasClass( "open" ) );

	protected override void OnEvent( PanelEvent e )
	{
		if ( e.Name == "save" )
			ClientSettings.Current.Save();
	}
}
